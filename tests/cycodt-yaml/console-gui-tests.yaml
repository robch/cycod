class: console-gui-tests
tag: cycod
tests:

# ============================================================================
# Test 1: Verify chat version works
# Basic sanity check
# ============================================================================
- name: chat version command works
  run: src/cycod/bin/Debug/net9.0/cycod.exe chat --version
  expect-regex: |
    Version:

# ============================================================================
# Test 2: Verify --speech flag is in help
# This tests that the documentation is updated
# ============================================================================
- name: speech option in help
  run: src/cycod/bin/Debug/net9.0/cycod.exe help options
  expect-regex: |
    --speech

# ============================================================================
# Test 3: Verify chat immediate exit in piped mode
# Tests that basic chat functionality works
# ============================================================================
- name: chat immediate exit in piped mode
  run: src/cycod/bin/Debug/net9.0/cycod.exe chat --inputs @@- --openai-api-key fake --use-openai
  input: |
    exit
  expect-regex: |
    User: exit

# ============================================================================
# Test 4: Verify context menu manual test documentation
# This test documents how to manually test the context menu
# ============================================================================
- name: context menu manual test instructions
  script: |
    echo "MANUAL TEST: Context Menu"
    echo "=========================="
    echo "1. Run: dotnet run --project src/cycod/cycod.csproj -- chat"
    echo "2. Press ENTER on empty line"
    echo "3. Verify menu appears with:"
    echo "   - Continue chatting"
    echo "   - Reset conversation"
    echo "   - Exit"
    echo "4. Test arrow key navigation"
    echo "5. Select 'Reset conversation'"
    echo "6. Verify conversation is cleared"
    echo "7. Press ENTER again, select 'Exit'"
    echo ""
    echo "MANUAL TEST: Speech input (requires Azure credentials)"
    echo "======================================================"
    echo "1. Set up speech.key and speech.region files in .cycod/"
    echo "2. Run: dotnet run --project src/cycod/cycod.csproj -- chat --speech"
    echo "3. Press ENTER on empty line"
    echo "4. Verify menu shows 'Speech input' option"
    echo "5. Select 'Speech input'"
    echo "6. Speak into microphone"
    echo "7. Verify interim results display"
    echo "8. Verify final text is recognized"
  expect-regex: |
    MANUAL TEST: Context Menu
  optional: documentation
